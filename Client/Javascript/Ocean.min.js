var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Ocean;(function(t){var e=function(){function t(t){this.gl=t,this.program=t.createProgram(),this.offsetBuffer=t.createBuffer(),this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer()}return t.prototype.update=function(t){this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,new Float32Array(t)),this.program.vertexPositionAttribute=this.gl.getAttribLocation(this.program,"position"),this.gl.enableVertexAttribArray(this.program.vertexPositionAttribute),this.gl.useProgram(null)},t.prototype.createProgram=function(t,e,i){var r=document.getElementById(t),n=document.getElementById(e),a=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(a,r.textContent),this.gl.compileShader(a);var s=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(s,n.textContent),this.gl.compileShader(s),this.gl.attachShader(this.program,a),this.gl.attachShader(this.program,s);var o=this.gl.getShaderInfoLog(a),h=this.gl.getShaderInfoLog(s);console.log(o),console.log(h),this.gl.linkProgram(this.program);this.gl.getProgramInfoLog(this.program);this.gl.useProgram(this.program),i?(this.program.time=this.gl.getUniformLocation(this.program,"time"),this.program.spectrum=this.gl.getUniformLocation(this.program,"displacement"),this.program.reflection=this.gl.getUniformLocation(this.program,"reflectionSampler"),this.program.refraction=this.gl.getUniformLocation(this.program,"refractionSampler")):(this.program.texture=this.gl.getUniformLocation(this.program,"texture"),this.program.clipPlane=this.gl.getUniformLocation(this.program,"clipplane"),this.program.isclipped=this.gl.getUniformLocation(this.program,"isclipped")),this.program.cameraPosition=this.gl.getUniformLocation(this.program,"cameraPosition"),this.program.texcoord=this.gl.getAttribLocation(this.program,"texCoord"),this.program.vertexPositionAttribute=this.gl.getAttribLocation(this.program,"position"),this.program.projectionMatrix=this.gl.getUniformLocation(this.program,"projMatrix"),this.program.viewMatrixMatrix=this.gl.getUniformLocation(this.program,"viewMatrix"),this.program.invViewMatrix=this.gl.getUniformLocation(this.program,"invViewMatrix"),this.program.invProjMatrix=this.gl.getUniformLocation(this.program,"invProjMatrix"),this.program.birdviewMatrix=this.gl.getUniformLocation(this.program,"birdviewMatrix"),this.gl.useProgram(null)},t}();t.Buffer=e})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(t){function e(e,i){t.call(this,e),this.gl=e,this.size=i,this.indices=[],this.vertices=[],this.clipPlane=[],t.prototype.createProgram.call(this,"vertexShader","fragmentShader",!0)}return __extends(e,t),e.prototype.update=function(){t.prototype.update.call(this,this.vertices)},e.prototype.create=function(){for(var t=0,e=0,i=0;i<this.size+1;i++)for(var r=0;r<this.size+1;r++)this.vertices[t]=-1+2*i/this.size,this.vertices[t+1]=0,this.vertices[t+2]=-1+2*r/this.size,t+=3;for(var i=0;i<this.size;i++)for(var r=0;r<this.size;r++)this.indices[e]=i+r*(this.size+1),this.indices[e+1]=i+1+r*(this.size+1),this.indices[e+2]=i+(r+1)*(this.size+1),this.indices[e+3]=i+(r+1)*(this.size+1),this.indices[e+4]=i+1+r*(this.size+1),this.indices[e+5]=i+1+(r+1)*(this.size+1),e+=6;this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(this.indices),this.gl.DYNAMIC_DRAW),this.gl.useProgram(null)},e.prototype.Draw=function(t,e,i,r,n,a,s,o,h,u,c){this.gl.useProgram(this.program),this.gl.uniform3f(this.program.cameraPosition,i.position[0],i.position[1],i.position[2]),this.gl.uniform3f(this.program.upVector,i.up[0],i.up[1],i.up[2]),this.gl.uniform3f(this.program.lookAt,i.lookAt[0],i.lookAt[1],i.lookAt[2]),this.gl.uniformMatrix4fv(this.program.invViewMatrix,!1,u),this.gl.uniformMatrix4fv(this.program.invProjMatrix,!1,h),this.gl.uniformMatrix4fv(this.program.projectionMatrix,!1,r),this.gl.uniformMatrix4fv(this.program.viewMatrixMatrix,!1,n),this.gl.uniformMatrix4fv(this.program.birdviewMatrix,!1,c),this.gl.bindTexture(this.gl.TEXTURE_2D,s.displacementTexture),this.gl.activeTexture(this.gl.TEXTURE0+1),this.gl.uniform1i(this.program.reflection,1),this.gl.bindTexture(this.gl.TEXTURE_2D,a.texture),this.gl.activeTexture(this.gl.TEXTURE0+2),this.gl.uniform1i(this.program.reflection,2),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.enableVertexAttribArray(this.program.vertexPositionAttribute),this.gl.vertexAttribPointer(this.program.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.drawElements(e,this.indices.length,this.gl.UNSIGNED_INT,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.disable(this.gl.BLEND),this.gl.useProgram(null)},e}(t.Buffer);t.chunck=e})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(){function t(t,e){this.x=t,this.y=e}return t.Conj=function(e){return new t(e.x,-e.y)},t.add=function(e,i){return new t(e.x+i.x,e.y+i.y)},t.substract=function(e,i){return new t(e.x-i.x,e.y-i.y)},t.mult=function(e,i){return new t(e.x*i.x-e.y*i.y,e.x*i.y+i.x*e.y)},t.multScalar=function(e,i){return new t(e.x*i,e.y*i)},t.divideScalar=function(e,i){return new t(e.x/i,e.y/i)},t.Polar=function(e,i){return new t(e*Math.cos(i),e*Math.sin(i))},t.Modulus=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t}();t.Complex=e})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(){function e(t){this.size=t}return e.prototype.Inverse=function(e){for(var i=[],r=0;r<e.length;r++)e[r]=t.Complex.Conj(e[r]);i=this.Forward(e);for(var r=0;r<e.length;r++)i[r]=t.Complex.Conj(i[r]);return i},e.prototype.Forward=function(e){var i=new Array(e.length),r=-2*Math.PI/e.length;if(e.length<=1)return i[0]=e[0],(isNaN(e[0].x)||isNaN(e[0].y))&&(i[0]=new t.Complex(0,0),e[0]=i[0]),i;for(var n=new Array(e.length/2),a=new Array(e.length/2),s=0;s<e.length/2;s++)n[s]=e[2*s],a[s]=e[2*s+1];for(var o=this.Forward(n),h=this.Forward(a),s=0;s<e.length/2;s++){var u=t.Complex.Polar(1,r*s);h[s]=t.Complex.mult(h[s],u)}for(var s=0;s<e.length/2;s++)i[s]=t.Complex.add(o[s],h[s]),i[s+e.length/2]=t.Complex.substract(o[s],h[s]);return i},e}();t.FFT=e;var i=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.Inverse2D=function(i){for(var r=[],n=[],a=[],s=[],o=0;o<this.size;o++)r[o]=e.prototype.Inverse.call(this,i[o]);for(var o=0;o<this.size;o++){a[o]=new Array(this.size);for(var h=0;h<this.size;h++)a[o][h]=t.Complex.divideScalar(r[h][o],this.size*this.size);n[o]=e.prototype.Inverse.call(this,a[o])}for(var h=0;h<this.size;h++){s[h]=[];for(var o=0;o<this.size;o++)s[h][o]=n[h][o].x}return s},i}(e);t.FFT2D=i})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(){function e(e,i,r){this.gl=e,this.canvas=i,this.projMatrix=mat4.create(),this.viewMatrix=mat4.create(),this.birdViewMatrix=mat4.create(),this.invProj=mat4.create(),this.invView=mat4.create(),this.chunck=new t.chunck(e,512),this.interval=1,this.ext=this.gl.getExtension("ANGLE_instanced_arrays"),this.floatExtension=this.gl.getExtension("OES_texture_float"),this.gl.getExtension("OES_texture_float_linear"),this.Phillips=new t.Phillips(this.gl,64),this.h0=this.Phillips.createH0(),this.h1=this.Phillips.createH1(),this.fft=new t.FFT2D(64),this.frameNumber=0,this.wireframe=r,this.skybox=new t.SkyBox(e,100),this.reflection=new t.FrameBuffer(window.innerWidth,window.innerHeight,this.gl),this.camera=new t.Camera(vec3.create([26,2,326]),vec3.create([26.417,2,325.4]),vec3.create([0,1,0])),this.birdCamera=new t.Camera(vec3.create([26,140,400]),vec3.create([26.417,131.32,325.4]),vec3.create([0,1,0])),this.displacementTexture=new t.Texture(this.gl,64)}return e.prototype.load=function(){this.gl.getExtension("OES_element_index_uint"),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(1,1,1,1),this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.skybox.create(),this.chunck.create(),this.reflection.CreateFrameBuffer()},e.prototype.generateWaves=function(){var t=this;this.frameNumber=window.requestAnimationFrame(function(){t.interval+=1/6;var e=t.Phillips.update(t.interval,t.h0,t.h1),i=t.fft.Inverse2D(e.h),r=t.fft.Inverse2D(e.x),n=t.fft.Inverse2D(e.z);t.displacementTexture.texture(r,i,n),t.render()})},e.prototype.render=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);var t=document.getElementById("camera-height");t.value=this.camera.position[1];var e=mat4.create([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1]),i=mat4.create();mat4.multiply(this.viewMatrix,e,i),this.reflection.BeginRenderframeBuffer(),this.skybox.render(this.projMatrix,i,!0,!1),this.reflection.EndRenderBuffer(),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.skybox.render(this.projMatrix,this.viewMatrix,!1,!1),this.generateWaves(),mat4.perspective(55,1,.1,4e3,this.projMatrix),mat4.perspective(65,1,.01,4e3,this.invProj),mat4.lookAt(this.camera.position,this.camera.lookAt,this.camera.up,this.viewMatrix),mat4.inverse(this.viewMatrix,this.invView),mat4.inverse(this.invProj,this.invProj),this.chunck.Draw(this.ext,this.wireframe,this.camera,this.projMatrix,this.viewMatrix,this.reflection,this.displacementTexture,this.refraction,this.invProj,this.invView,this.birdViewMatrix)},e}();t.Engine=e})(Ocean||(Ocean={})),window.onload=function(){var t=document.getElementById("canvas");t.width=window.innerWidth,t.height=window.innerHeight;var e=t.getContext("experimental-webgl",{antialias:!0}),i=new Ocean.Engine(e,t,e.TRIANGLES);i.load(),i.render();var r=document.getElementById("choppiness"),n=document.getElementById("wireframe");n.onchange=function(t){i.wireframe===e.TRIANGLES?i.wireframe=e.LINES:i.wireframe=e.TRIANGLES},r.oninput=function(t){i.displacementTexture.lambda=parseInt(t.target.value)/10},document.onkeydown=function(t){switch(t.which){case 87:i.wireframe===e.TRIANGLES?i.wireframe=e.LINES:i.wireframe=e.TRIANGLES;break;case 39:i.camera.lookRight();break;case 37:i.camera.lookLeft();break;case 38:i.camera.moveForward();break;case 40:i.camera.moveBackward();break;case 90:i.camera.moveDown();break;case 65:i.camera.moveUp();break;case 83:i.camera.lookDown();break;case 88:i.camera.lookUp()}}};var Ocean;(function(t){var e=function(){function e(t,e){this.size=e,this.gl=t,this.length=1100,this.windspeed=50,this.windX=-2,this.windY=-.5,this.A=1e-4,this.g=9.81}return e.prototype.createH0=function(){for(var e=[],i=0,r=new t.Plot("spectrum",64),n=0;n<2*this.size;n++){e[n]=[];for(var a=0;a<2*this.size;a++){var s={g:this.g,A:this.A,windSpeed:this.windspeed,windX:this.windX,windY:this.windY,Kx:2*Math.PI*(n-this.size/2)/this.length,Ky:2*Math.PI*(a-this.size/2)/this.length},o=this.spectrum(s),h=this.calculateH0(o);e[n][a]=h,r.imagedata.data[i]=255*o,r.imagedata.data[i+1]=255*o,r.imagedata.data[i+2]=255*o,r.imagedata.data[i+3]=255,i+=4}}return r.load(),e},e.prototype.createH1=function(){for(var e=[],i=0;i<2*this.size;i++){e[i]=[];for(var r=0;r<2*this.size;r++){var n={g:this.g,A:this.A,windSpeed:this.windspeed,windX:this.windX,windY:this.windY,Kx:2*Math.PI*(-i-this.size/2)/this.length,Ky:2*Math.PI*(-r-this.size/2)/this.length};t.Complex.Conj(this.calculateH0(this.spectrum(n)));e[i][r]=t.Complex.Conj(this.calculateH0(this.spectrum(n)))}}return e},e.prototype.update=function(e,i,r){for(var n,a=new t.Plot("hu",64),s={h:[],z:[],x:[]},o=0,h=0,u=0;u<this.size;u++){s.h[u]=[],s.z[u]=[],s.x[u]=[];for(var c=(new t.Complex(0,0),0);c<this.size;c++){n=2*Math.PI*(u-this.size/2)/this.length,o=2*Math.PI*(c-this.size/2)/this.length;var l=Math.sqrt(n*n+o*o),g=Math.sqrt(9.81*l),f=t.Complex.Polar(1,g*e),p=t.Complex.mult(i[u][c],f),m=t.Complex.mult(r[u][c],t.Complex.Conj(f)),d=t.Complex.add(p,m),v=t.Complex.mult(new t.Complex(0,1),d),M=t.Complex.multScalar(v,n/l),x=t.Complex.multScalar(v,o/l);a.imagedata.data[h]=255*M.x,a.imagedata.data[h+1]=255*d.x,a.imagedata.data[h+2]=255*x.x,a.imagedata.data[h+3]=255,h+=4,s.h[u][c]=d,s.z[u][c]=x,s.x[u][c]=M}}return a.load(),s},e.prototype.spectrum=function(t){var e=Math.sqrt(t.Kx*t.Kx+t.Ky*t.Ky);e<1e-6&&(e=0);var i=Math.sqrt(t.windX*t.windX+t.windY*t.windY),r=t.windSpeed*t.windSpeed*i/t.g,n=t.Kx/e,a=t.Ky/e,s=n*t.windX/i+a*t.windY/i;if(0==s)return 0;var o=t.A/(e*e*e*e)*Math.exp(-1/(e*e*r*r))*s*s*s*s;return o},e.prototype.calculateH0=function(e){this.randomBM();return new t.Complex(1/Math.sqrt(2)*this.randomBM()*Math.sqrt(e),1/Math.sqrt(2)*this.randomBM()*Math.sqrt(e))},e.prototype.randomBM=function(){var t=1-Math.random(),e=1-Math.random();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e)},e}();t.Phillips=e})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(){function e(e,i){this.gl=e,this.size=i,this.lambda=.8,this.displacementTexture=this.gl.createTexture(),this.normalTextures=this.gl.createTexture(),this.plot=new t.Plot("spacial",64)}return e.prototype.texture=function(t,e,i){for(var r=[],n=0,a=0,s=[1,-1],o=0;o<this.size;o++)for(var h=0;h<this.size;h++){var u=s[o+h&1];r[n]=t[o][h]*this.lambda*u,r[n+1]=e[o][h]*u,r[n+2]=i[o][h]*this.lambda*u,r[n+3]=1,this.plot.imagedata.data[a]=255*r[n]*10,this.plot.imagedata.data[a+1]=255*r[n+1]*10,this.plot.imagedata.data[a+2]=255*r[n+2]*10,this.plot.imagedata.data[a+3]=255,a+=4,n+=4}return this.plot.load(),this.createTexturefromData(r)},e.prototype.createTexturefromData=function(t){return this.gl.bindTexture(this.gl.TEXTURE_2D,this.displacementTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.size,this.size,0,this.gl.RGBA,this.gl.FLOAT,new Float32Array(t)),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this},e.prototype.createTexture=function(t){var e=this,i=new Image(512,512),r=this.gl.createTexture();i.addEventListener("load",function(){e.gl.bindTexture(e.gl.TEXTURE_2D,r),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MIN_FILTER,e.gl.LINEAR_MIPMAP_LINEAR),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MAG_FILTER,e.gl.LINEAR_MIPMAP_LINEAR),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_S,e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_T,e.gl.CLAMP_TO_EDGE),e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,e.gl.RGBA,e.gl.UNSIGNED_BYTE,i),e.gl.bindTexture(e.gl.TEXTURE_2D,null),t(r)},!1),i.src="images/Skybox2.jpg"},e}();t.Texture=e})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(e){function i(i,r){var n=this;e.call(this,i),this.gl=i,this.size=r,this.indices=[],new t.Texture(this.gl,512).createTexture(function(t){n.texture=t}),e.prototype.createProgram.call(this,"skyBoxVertexShader","skyBoxfragmentShader",!1)}return __extends(i,e),i.prototype.create=function(){var t=[-1,-1,-1,.25,2/3,-1,-1,1,.25,1,1,-1,1,.5,1,1,-1,-1,.5,2/3,-1,1,-1,.25,1/3,-1,1,1,.25,0,1,1,1,.5,0,1,1,-1,.5,1/3,-1,-1,-1,.25,2/3,-1,1,-1,.25,1/3,1,1,-1,.5,1/3,1,-1,-1,.5,2/3,-1,-1,1,1,2/3,-1,1,1,1,1/3,1,1,1,.75,1/3,1,-1,1,.75,2/3,1,-1,-1,.5,2/3,1,1,-1,.5,1/3,1,1,1,.75,1/3,1,-1,1,.75,2/3,-1,-1,-1,.25,2/3,-1,1,-1,.25,1/3,-1,1,1,0,1/3,-1,-1,1,0,2/3];this.indices=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16,20,21,22,22,23,20],this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint8Array(this.indices),this.gl.STATIC_DRAW),this.gl.useProgram(null)},i.prototype.render=function(t,e,i,r){this.gl.useProgram(this.program),r?this.gl.uniform4f(this.program.clipPlane,0,1,0,1):this.gl.uniform4f(this.program.clipPlane,0,-1,0,1),i?this.gl.uniform1f(this.program.isclipped,1):this.gl.uniform1f(this.program.isclipped,0),this.gl.uniformMatrix4fv(this.program.projectionMatrix,!1,t),this.gl.uniformMatrix4fv(this.program.viewMatrixMatrix,!1,e),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.enableVertexAttribArray(this.program.vertexPositionAttribute),this.gl.vertexAttribPointer(this.program.vertexPositionAttribute,3,this.gl.FLOAT,!1,20,0),this.gl.vertexAttribPointer(this.program.texcoord,2,this.gl.FLOAT,!1,20,12),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.depthMask(!1),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_BYTE,0),this.gl.depthMask(!0),this.gl.useProgram(null)},i}(t.Buffer);t.SkyBox=e})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(){function t(t,e,i){this.position=vec3.create(t),this.lookAt=vec3.create(e),this.up=vec3.create(i),this.angle=-1.035,this.pitch=2.17,this.speed=.25}return t.prototype.moveForward=function(){vec3.add(this.position,[this.speed*Math.cos(this.angle)*Math.sin(this.pitch),this.speed*Math.cos(this.pitch),this.speed*Math.sin(this.angle)*Math.sin(this.pitch)],this.position),vec3.add(this.position,[Math.cos(this.angle)*Math.sin(this.pitch),Math.cos(this.pitch),Math.sin(this.angle)*Math.sin(this.pitch)],this.lookAt)},t.prototype.moveBackward=function(){vec3.add(this.position,[-this.speed*Math.cos(this.angle)*Math.sin(this.pitch),-this.speed*Math.cos(this.pitch),-this.speed*Math.sin(this.angle)*Math.sin(this.pitch)],this.position),vec3.add(this.position,[Math.cos(this.angle)*Math.sin(this.pitch),Math.cos(this.pitch),Math.sin(this.angle)*Math.sin(this.pitch)],this.lookAt)},t.prototype.moveUp=function(){vec3.add(this.position,[0,this.speed,0],this.position),vec3.add(this.lookAt,[0,this.speed,0],this.lookAt)},t.prototype.moveDown=function(){vec3.add(this.position,[0,-this.speed,0],this.position),vec3.add(this.lookAt,[0,-this.speed,0],this.lookAt)},t.prototype.lookRight=function(){this.angle+=.05,vec3.add(this.position,[Math.cos(this.angle)*Math.sin(this.pitch),Math.cos(this.pitch),Math.sin(this.angle)*Math.sin(this.pitch)],this.lookAt)},t.prototype.lookLeft=function(){this.angle-=.05,vec3.add(this.position,[Math.cos(this.angle)*Math.sin(this.pitch),Math.cos(this.pitch),Math.sin(this.angle)*Math.sin(this.pitch)],this.lookAt)},t.prototype.lookUp=function(){this.pitch+=.05,vec3.add(this.position,[Math.cos(this.angle)*Math.sin(this.pitch),Math.cos(this.pitch),Math.sin(this.angle)*Math.sin(this.pitch)],this.lookAt)},t.prototype.lookDown=function(){this.pitch-=.05,vec3.add(this.position,[Math.cos(this.angle)*Math.sin(this.pitch),Math.cos(this.pitch),Math.sin(this.angle)*Math.sin(this.pitch)],this.lookAt)},t.prototype.invertPitch=function(){this.pitch=-this.pitch},t.prototype.log=function(){console.log(this.position),console.log(this.lookAt),console.log(this.angle),console.log(this.pitch)},t}();t.Camera=e})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(){function t(t,e){this.canvas=document.createElement("canvas"),this.canvas.width=64,this.canvas.height=64,this.img=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.imagedata=this.ctx.createImageData(e,e)}return t.prototype.load=function(){this.ctx.putImageData(this.imagedata,0,0),this.ctx.scale(4,4);var t=this.canvas.toDataURL("image/png");this.img.src=t},t}();t.Plot=e})(Ocean||(Ocean={}));var Ocean;(function(t){var e=function(){function t(t,e,i){this.width=t,this.height=e,this.distance=0,this.gl=i,this.texture=i.createTexture(),this.framBuffer=this.gl.createFramebuffer(),this.renderbuffer=this.gl.createRenderbuffer()}return t.prototype.InitEmptyTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,512,512,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)},t.prototype.CreateFrameBuffer=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framBuffer),this.InitEmptyTexture(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.renderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,512,512),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture,0),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.renderbuffer),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},t.prototype.BeginRenderframeBuffer=function(){this.gl.viewport(0,0,512,512),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framBuffer),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},t.prototype.EndRenderBuffer=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.width,this.height)},t}();t.FrameBuffer=e})(Ocean||(Ocean={})),function(t,e){"object"==typeof exports?module.exports=e(global):"function"==typeof define&&define.amd?define([],function(){return e(t)}):e(t)}(this,function(t){function e(t){return n=t}function i(){return n="undefined"!=typeof Float32Array?Float32Array:Array}var r={};(function(){if("undefined"!=typeof Float32Array){var t=new Float32Array(1),e=new Int32Array(t.buffer);r.invsqrt=function(i){t[0]=i,e[0]=1597463007-(e[0]>>1);var r=t[0];return r*(1.5-.5*i*r*r)}}else r.invsqrt=function(t){return 1/Math.sqrt(t)}})();var n=null;i();var a={create:function(t){var e=new n(3);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):e[0]=e[1]=e[2]=0,e},createFrom:function(t,e,i){var r=new n(3);return r[0]=t,r[1]=e,r[2]=i,r},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},equal:function(t,e){return t===e||1e-6>Math.abs(t[0]-e[0])&&1e-6>Math.abs(t[1]-e[1])&&1e-6>Math.abs(t[2]-e[2])},add:function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},subtract:function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},multiply:function(t,e,i){return i&&t!==i?(i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i):(t[0]*=e[0],t[1]*=e[1],t[2]*=e[2],t)},negate:function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},scale:function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},normalize:function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],a=Math.sqrt(i*i+r*r+n*n);return a?1===a?(e[0]=i,e[1]=r,e[2]=n,e):(a=1/a,e[0]=i*a,e[1]=r*a,e[2]=n*a,e):(e[0]=0,e[1]=0,e[2]=0,e)},cross:function(t,e,i){i||(i=t);var r=t[0],n=t[1],t=t[2],a=e[0],s=e[1],e=e[2];return i[0]=n*e-t*s,i[1]=t*a-r*e,i[2]=r*s-n*a,i},length:function(t){var e=t[0],i=t[1],t=t[2];return Math.sqrt(e*e+i*i+t*t)},squaredLength:function(t){var e=t[0],i=t[1],t=t[2];return e*e+i*i+t*t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},direction:function(t,e,i){i||(i=t);var r=t[0]-e[0],n=t[1]-e[1],t=t[2]-e[2],e=Math.sqrt(r*r+n*n+t*t);return e?(e=1/e,i[0]=r*e,i[1]=n*e,i[2]=t*e,i):(i[0]=0,i[1]=0,i[2]=0,i)},lerp:function(t,e,i,r){return r||(r=t),r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r[2]=t[2]+i*(e[2]-t[2]),r},dist:function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}},s=null,o=new n(4);a.unproject=function(t,e,i,r,n){n||(n=t),s||(s=f.create());var a=s;return o[0]=2*(t[0]-r[0])/r[2]-1,o[1]=2*(t[1]-r[1])/r[3]-1,o[2]=2*t[2]-1,o[3]=1,f.multiply(i,e,a),f.inverse(a)?(f.multiplyVec4(a,o),0===o[3]?null:(n[0]=o[0]/o[3],n[1]=o[1]/o[3],n[2]=o[2]/o[3],n)):null};var h=a.createFrom(1,0,0),u=a.createFrom(0,1,0),c=a.createFrom(0,0,1),l=a.create();a.rotationTo=function(t,e,i){i||(i=p.create());var r=a.dot(t,e);if(1<=r)p.set(m,i);else if(-.999999>r)a.cross(h,t,l),1e-6>a.length(l)&&a.cross(u,t,l),1e-6>a.length(l)&&a.cross(c,t,l),a.normalize(l),p.fromAngleAxis(Math.PI,l,i);else{var r=Math.sqrt(2*(1+r)),n=1/r;a.cross(t,e,l),i[0]=l[0]*n,i[1]=l[1]*n,i[2]=l[2]*n,i[3]=.5*r,p.normalize(i)}return 1<i[3]?i[3]=1:-1>i[3]&&(i[3]=-1),i},a.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"};var g={create:function(t){var e=new n(9);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]):e[0]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=0,e},createFrom:function(t,e,i,r,a,s,o,h,u){var c=new n(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=a,c[5]=s,c[6]=o,c[7]=h,c[8]=u,c},determinant:function(t){var e=t[3],i=t[4],r=t[5],n=t[6],a=t[7],s=t[8];return t[0]*(s*i-r*a)+t[1]*(-s*e+r*n)+t[2]*(a*e-i*n)},inverse:function(t,e){var i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],u=t[7],c=t[8],l=c*s-o*u,f=-c*a+o*h,p=u*a-s*h,m=i*l+r*f+n*p;return m?(m=1/m,e||(e=g.create()),e[0]=l*m,e[1]=(-c*r+n*u)*m,e[2]=(o*r-n*s)*m,e[3]=f*m,e[4]=(c*i-n*h)*m,e[5]=(-o*i+n*a)*m,e[6]=p*m,e[7]=(-u*i+r*h)*m,e[8]=(s*i-r*a)*m,e):null},multiply:function(t,e,i){i||(i=t);var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],t=t[8],l=e[0],g=e[1],f=e[2],p=e[3],m=e[4],d=e[5],v=e[6],M=e[7],e=e[8];return i[0]=l*r+g*s+f*u,i[1]=l*n+g*o+f*c,i[2]=l*a+g*h+f*t,i[3]=p*r+m*s+d*u,i[4]=p*n+m*o+d*c,i[5]=p*a+m*h+d*t,i[6]=v*r+M*s+e*u,i[7]=v*n+M*o+e*c,i[8]=v*a+M*h+e*t,i},multiplyVec2:function(t,e,i){i||(i=e);var r=e[0],e=e[1];return i[0]=r*t[0]+e*t[3]+t[6],i[1]=r*t[1]+e*t[4]+t[7],i},multiplyVec3:function(t,e,i){i||(i=e);var r=e[0],n=e[1],e=e[2];return i[0]=r*t[0]+n*t[3]+e*t[6],i[1]=r*t[1]+n*t[4]+e*t[7],i[2]=r*t[2]+n*t[5]+e*t[8],i},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},equal:function(t,e){return t===e||1e-6>Math.abs(t[0]-e[0])&&1e-6>Math.abs(t[1]-e[1])&&1e-6>Math.abs(t[2]-e[2])&&1e-6>Math.abs(t[3]-e[3])&&1e-6>Math.abs(t[4]-e[4])&&1e-6>Math.abs(t[5]-e[5])&&1e-6>Math.abs(t[6]-e[6])&&1e-6>Math.abs(t[7]-e[7])&&1e-6>Math.abs(t[8]-e[8])},identity:function(t){return t||(t=g.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=r,t[7]=n,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},toMat4:function(t,e){return e||(e=f.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"}},f={create:function(t){var e=new n(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},createFrom:function(t,e,i,r,a,s,o,h,u,c,l,g,f,p,m,d){var v=new n(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=a,v[5]=s,v[6]=o,v[7]=h,v[8]=u,v[9]=c,v[10]=l,v[11]=g,v[12]=f,v[13]=p,v[14]=m,v[15]=d,v},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},equal:function(t,e){return t===e||1e-6>Math.abs(t[0]-e[0])&&1e-6>Math.abs(t[1]-e[1])&&1e-6>Math.abs(t[2]-e[2])&&1e-6>Math.abs(t[3]-e[3])&&1e-6>Math.abs(t[4]-e[4])&&1e-6>Math.abs(t[5]-e[5])&&1e-6>Math.abs(t[6]-e[6])&&1e-6>Math.abs(t[7]-e[7])&&1e-6>Math.abs(t[8]-e[8])&&1e-6>Math.abs(t[9]-e[9])&&1e-6>Math.abs(t[10]-e[10])&&1e-6>Math.abs(t[11]-e[11])&&1e-6>Math.abs(t[12]-e[12])&&1e-6>Math.abs(t[13]-e[13])&&1e-6>Math.abs(t[14]-e[14])&&1e-6>Math.abs(t[15]-e[15])},identity:function(t){return t||(t=f.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transpose:function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[3],a=t[6],s=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=a,t[11]=t[14],t[12]=n,t[13]=s,t[14]=o,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},determinant:function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],s=t[5],o=t[6],h=t[7],u=t[8],c=t[9],l=t[10],g=t[11],f=t[12],p=t[13],m=t[14],t=t[15];return f*c*o*n-u*p*o*n-f*s*l*n+a*p*l*n+u*s*m*n-a*c*m*n-f*c*r*h+u*p*r*h+f*i*l*h-e*p*l*h-u*i*m*h+e*c*m*h+f*s*r*g-a*p*r*g-f*i*o*g+e*p*o*g+a*i*m*g-e*s*m*g-u*s*r*t+a*c*r*t+u*i*o*t-e*c*o*t-a*i*l*t+e*s*l*t},inverse:function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],u=t[7],c=t[8],l=t[9],g=t[10],f=t[11],p=t[12],m=t[13],d=t[14],v=t[15],M=i*o-r*s,x=i*h-n*s,E=i*u-a*s,T=r*h-n*o,R=r*u-a*o,A=n*u-a*h,b=c*m-l*p,w=c*d-g*p,y=c*v-f*p,_=l*d-g*m,F=l*v-f*m,B=g*v-f*d,P=M*B-x*F+E*_+T*y-R*w+A*b;return P?(P=1/P,e[0]=(o*B-h*F+u*_)*P,e[1]=(-r*B+n*F-a*_)*P,e[2]=(m*A-d*R+v*T)*P,e[3]=(-l*A+g*R-f*T)*P,e[4]=(-s*B+h*y-u*w)*P,e[5]=(i*B-n*y+a*w)*P,e[6]=(-p*A+d*E-v*x)*P,e[7]=(c*A-g*E+f*x)*P,e[8]=(s*F-o*y+u*b)*P,e[9]=(-i*F+r*y-a*b)*P,e[10]=(p*R-m*E+v*M)*P,e[11]=(-c*R+l*E-f*M)*P,e[12]=(-s*_+o*w-h*b)*P,e[13]=(i*_-r*w+n*b)*P,e[14]=(-p*T+m*x-d*M)*P,e[15]=(c*T-l*x+g*M)*P,e):null},toRotationMat:function(t,e){return e||(e=f.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},toMat3:function(t,e){return e||(e=g.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},toInverseMat3:function(t,e){var i=t[0],r=t[1],n=t[2],a=t[4],s=t[5],o=t[6],h=t[8],u=t[9],c=t[10],l=c*s-o*u,f=-c*a+o*h,p=u*a-s*h,m=i*l+r*f+n*p;return m?(m=1/m,e||(e=g.create()),e[0]=l*m,e[1]=(-c*r+n*u)*m,e[2]=(o*r-n*s)*m,e[3]=f*m,e[4]=(c*i-n*h)*m,e[5]=(-o*i+n*a)*m,e[6]=p*m,e[7]=(-u*i+r*h)*m,e[8]=(s*i-r*a)*m,e):null},multiply:function(t,e,i){i||(i=t);var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],g=t[9],f=t[10],p=t[11],m=t[12],d=t[13],v=t[14],t=t[15],M=e[0],x=e[1],E=e[2],T=e[3];return i[0]=M*r+x*o+E*l+T*m,i[1]=M*n+x*h+E*g+T*d,i[2]=M*a+x*u+E*f+T*v,i[3]=M*s+x*c+E*p+T*t,M=e[4],x=e[5],E=e[6],T=e[7],i[4]=M*r+x*o+E*l+T*m,i[5]=M*n+x*h+E*g+T*d,i[6]=M*a+x*u+E*f+T*v,i[7]=M*s+x*c+E*p+T*t,M=e[8],x=e[9],E=e[10],T=e[11],i[8]=M*r+x*o+E*l+T*m,i[9]=M*n+x*h+E*g+T*d,i[10]=M*a+x*u+E*f+T*v,i[11]=M*s+x*c+E*p+T*t,M=e[12],x=e[13],E=e[14],T=e[15],i[12]=M*r+x*o+E*l+T*m,i[13]=M*n+x*h+E*g+T*d,i[14]=M*a+x*u+E*f+T*v,i[15]=M*s+x*c+E*p+T*t,i},multiplyVec3:function(t,e,i){i||(i=e);var r=e[0],n=e[1],e=e[2];return i[0]=t[0]*r+t[4]*n+t[8]*e+t[12],i[1]=t[1]*r+t[5]*n+t[9]*e+t[13],i[2]=t[2]*r+t[6]*n+t[10]*e+t[14],i},multiplyVec4:function(t,e,i){i||(i=e);var r=e[0],n=e[1],a=e[2],e=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*a+t[12]*e,i[1]=t[1]*r+t[5]*n+t[9]*a+t[13]*e,i[2]=t[2]*r+t[6]*n+t[10]*a+t[14]*e,i[3]=t[3]*r+t[7]*n+t[11]*a+t[15]*e,i},translate:function(t,e,i){var r,n,a,s,o,h,u,c,l,g,f,p,m=e[0],d=e[1],e=e[2];return i&&t!==i?(r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],g=t[9],f=t[10],p=t[11],i[0]=r,i[1]=n,i[2]=a,i[3]=s,i[4]=o,i[5]=h,i[6]=u,i[7]=c,i[8]=l,i[9]=g,i[10]=f,i[11]=p,i[12]=r*m+o*d+l*e+t[12],i[13]=n*m+h*d+g*e+t[13],i[14]=a*m+u*d+f*e+t[14],i[15]=s*m+c*d+p*e+t[15],i):(t[12]=t[0]*m+t[4]*d+t[8]*e+t[12],t[13]=t[1]*m+t[5]*d+t[9]*e+t[13],t[14]=t[2]*m+t[6]*d+t[10]*e+t[14],t[15]=t[3]*m+t[7]*d+t[11]*e+t[15],t)},scale:function(t,e,i){var r=e[0],n=e[1],e=e[2];return i&&t!==i?(i[0]=t[0]*r,i[1]=t[1]*r,
i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},rotate:function(t,e,i,r){var n,a,s,o,h,u,c,l,g,f,p,m,d,v,M,x,E,T,R,A,b=i[0],w=i[1],i=i[2],y=Math.sqrt(b*b+w*w+i*i);return y?(1!==y&&(y=1/y,b*=y,w*=y,i*=y),n=Math.sin(e),a=Math.cos(e),s=1-a,e=t[0],y=t[1],o=t[2],h=t[3],u=t[4],c=t[5],l=t[6],g=t[7],f=t[8],p=t[9],m=t[10],d=t[11],v=b*b*s+a,M=w*b*s+i*n,x=i*b*s-w*n,E=b*w*s-i*n,T=w*w*s+a,R=i*w*s+b*n,A=b*i*s+w*n,b=w*i*s-b*n,w=i*i*s+a,r?t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=e*v+u*M+f*x,r[1]=y*v+c*M+p*x,r[2]=o*v+l*M+m*x,r[3]=h*v+g*M+d*x,r[4]=e*E+u*T+f*R,r[5]=y*E+c*T+p*R,r[6]=o*E+l*T+m*R,r[7]=h*E+g*T+d*R,r[8]=e*A+u*b+f*w,r[9]=y*A+c*b+p*w,r[10]=o*A+l*b+m*w,r[11]=h*A+g*b+d*w,r):null},rotateX:function(t,e,i){var r=Math.sin(e),e=Math.cos(e),n=t[4],a=t[5],s=t[6],o=t[7],h=t[8],u=t[9],c=t[10],l=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=n*e+h*r,i[5]=a*e+u*r,i[6]=s*e+c*r,i[7]=o*e+l*r,i[8]=n*-r+h*e,i[9]=a*-r+u*e,i[10]=s*-r+c*e,i[11]=o*-r+l*e,i},rotateY:function(t,e,i){var r=Math.sin(e),e=Math.cos(e),n=t[0],a=t[1],s=t[2],o=t[3],h=t[8],u=t[9],c=t[10],l=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+h*-r,i[1]=a*e+u*-r,i[2]=s*e+c*-r,i[3]=o*e+l*-r,i[8]=n*r+h*e,i[9]=a*r+u*e,i[10]=s*r+c*e,i[11]=o*r+l*e,i},rotateZ:function(t,e,i){var r=Math.sin(e),e=Math.cos(e),n=t[0],a=t[1],s=t[2],o=t[3],h=t[4],u=t[5],c=t[6],l=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+h*r,i[1]=a*e+u*r,i[2]=s*e+c*r,i[3]=o*e+l*r,i[4]=n*-r+h*e,i[5]=a*-r+u*e,i[6]=s*-r+c*e,i[7]=o*-r+l*e,i},frustum:function(t,e,i,r,n,a,s){s||(s=f.create());var o=e-t,h=r-i,u=a-n;return s[0]=2*n/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n/h,s[6]=0,s[7]=0,s[8]=(e+t)/o,s[9]=(r+i)/h,s[10]=-(a+n)/u,s[11]=-1,s[12]=0,s[13]=0,s[14]=-(2*a*n)/u,s[15]=0,s},perspective:function(t,e,i,r,n){return t=i*Math.tan(t*Math.PI/360),e*=t,f.frustum(-e,e,-t,t,i,r,n)},ortho:function(t,e,i,r,n,a,s){s||(s=f.create());var o=e-t,h=r-i,u=a-n;return s[0]=2/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/h,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/u,s[11]=0,s[12]=-(t+e)/o,s[13]=-(r+i)/h,s[14]=-(a+n)/u,s[15]=1,s},lookAt:function(t,e,i,r){r||(r=f.create());var n,a,s,o,h,u,c,l,g=t[0],p=t[1],t=t[2];return s=i[0],o=i[1],a=i[2],c=e[0],i=e[1],n=e[2],g===c&&p===i&&t===n?f.identity(r):(e=g-c,i=p-i,c=t-n,l=1/Math.sqrt(e*e+i*i+c*c),e*=l,i*=l,c*=l,n=o*c-a*i,a=a*e-s*c,s=s*i-o*e,(l=Math.sqrt(n*n+a*a+s*s))?(l=1/l,n*=l,a*=l,s*=l):s=a=n=0,o=i*s-c*a,h=c*n-e*s,u=e*a-i*n,(l=Math.sqrt(o*o+h*h+u*u))?(l=1/l,o*=l,h*=l,u*=l):u=h=o=0,r[0]=n,r[1]=o,r[2]=e,r[3]=0,r[4]=a,r[5]=h,r[6]=i,r[7]=0,r[8]=s,r[9]=u,r[10]=c,r[11]=0,r[12]=-(n*g+a*p+s*t),r[13]=-(o*g+h*p+u*t),r[14]=-(e*g+i*p+c*t),r[15]=1,r)},fromRotationTranslation:function(t,e,i){i||(i=f.create());var r=t[0],n=t[1],a=t[2],s=t[3],o=r+r,h=n+n,u=a+a,t=r*o,c=r*h,r=r*u,l=n*h,n=n*u,a=a*u,o=s*o,h=s*h,s=s*u;return i[0]=1-(l+a),i[1]=c+s,i[2]=r-h,i[3]=0,i[4]=c-s,i[5]=1-(t+a),i[6]=n+o,i[7]=0,i[8]=r+h,i[9]=n-o,i[10]=1-(t+l),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"}},p={create:function(t){var e=new n(4);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):e[0]=e[1]=e[2]=e[3]=0,e},createFrom:function(t,e,i,r){var a=new n(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},equal:function(t,e){return t===e||1e-6>Math.abs(t[0]-e[0])&&1e-6>Math.abs(t[1]-e[1])&&1e-6>Math.abs(t[2]-e[2])&&1e-6>Math.abs(t[3]-e[3])},identity:function(t){return t||(t=p.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}},m=p.identity();p.calculateW=function(t,e){var i=t[0],r=t[1],n=t[2];return e&&t!==e?(e[0]=i,e[1]=r,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t)},p.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},p.inverse=function(t,e){var i=t[0],r=t[1],n=t[2],a=t[3],i=(i=i*i+r*r+n*n+a*a)?1/i:0;return e&&t!==e?(e[0]=-t[0]*i,e[1]=-t[1]*i,e[2]=-t[2]*i,e[3]=t[3]*i,e):(t[0]*=-i,t[1]*=-i,t[2]*=-i,t[3]*=i,t)},p.conjugate=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},p.length=function(t){var e=t[0],i=t[1],r=t[2],t=t[3];return Math.sqrt(e*e+i*i+r*r+t*t)},p.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],a=t[3],s=Math.sqrt(i*i+r*r+n*n+a*a);return 0===s?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(s=1/s,e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=a*s,e)},p.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[3],t)},p.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],a=t[2],t=t[3],s=e[0],o=e[1],h=e[2],e=e[3];return i[0]=r*e+t*s+n*h-a*o,i[1]=n*e+t*o+a*s-r*h,i[2]=a*e+t*h+r*o-n*s,i[3]=t*e-r*s-n*o-a*h,i},p.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],a=e[2],e=t[0],s=t[1],o=t[2],t=t[3],h=t*r+s*a-o*n,u=t*n+o*r-e*a,c=t*a+e*n-s*r,r=-e*r-s*n-o*a;return i[0]=h*t+r*-e+u*-o-c*-s,i[1]=u*t+r*-s+c*-e-h*-o,i[2]=c*t+r*-o+h*-s-u*-e,i},p.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t)},p.toMat3=function(t,e){e||(e=g.create());var i=t[0],r=t[1],n=t[2],a=t[3],s=i+i,o=r+r,h=n+n,u=i*s,c=i*o,i=i*h,l=r*o,r=r*h,n=n*h,s=a*s,o=a*o,a=a*h;return e[0]=1-(l+n),e[1]=c+a,e[2]=i-o,e[3]=c-a,e[4]=1-(u+n),e[5]=r+s,e[6]=i+o,e[7]=r-s,e[8]=1-(u+l),e},p.toMat4=function(t,e){e||(e=f.create());var i=t[0],r=t[1],n=t[2],a=t[3],s=i+i,o=r+r,h=n+n,u=i*s,c=i*o,i=i*h,l=r*o,r=r*h,n=n*h,s=a*s,o=a*o,a=a*h;return e[0]=1-(l+n),e[1]=c+a,e[2]=i-o,e[3]=0,e[4]=c-a,e[5]=1-(u+n),e[6]=r+s,e[7]=0,e[8]=i+o,e[9]=r-s,e[10]=1-(u+l),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},p.slerp=function(t,e,i,r){r||(r=t);var n,a,s=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return 1<=Math.abs(s)?(r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r):(n=Math.acos(s),a=Math.sqrt(1-s*s),.001>Math.abs(a)?(r[0]=.5*t[0]+.5*e[0],r[1]=.5*t[1]+.5*e[1],r[2]=.5*t[2]+.5*e[2],r[3]=.5*t[3]+.5*e[3],r):(s=Math.sin((1-i)*n)/a,i=Math.sin(i*n)/a,r[0]=t[0]*s+e[0]*i,r[1]=t[1]*s+e[1]*i,r[2]=t[2]*s+e[2]*i,r[3]=t[3]*s+e[3]*i,r))},p.fromRotationMatrix=function(t,e){e||(e=p.create());var i,r=t[0]+t[4]+t[8];if(0<r)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[7]-t[5])*i,e[1]=(t[2]-t[6])*i,e[2]=(t[3]-t[1])*i;else{i=p.fromRotationMatrix.s_iNext=p.fromRotationMatrix.s_iNext||[1,2,0],r=0,t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var n=i[r],a=i[n];i=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*a+a]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*a+n]-t[3*n+a])*i,e[n]=(t[3*n+r]+t[3*r+n])*i,e[a]=(t[3*a+r]+t[3*r+a])*i}return e},g.toQuat4=p.fromRotationMatrix,function(){var t=g.create();p.fromAxes=function(e,i,r,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=e[0],t[5]=e[1],t[8]=e[2],p.fromRotationMatrix(t,n)}}(),p.identity=function(t){return t||(t=p.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},p.fromAngleAxis=function(t,e,i){i||(i=p.create());var t=.5*t,r=Math.sin(t);return i[3]=Math.cos(t),i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i},p.toAngleAxis=function(t,e){e||(e=t);var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];return 0<i?(e[3]=2*Math.acos(t[3]),i=r.invsqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i):(e[3]=0,e[0]=1,e[1]=0,e[2]=0),e},p.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};var d={create:function(t){var e=new n(2);return t?(e[0]=t[0],e[1]=t[1]):(e[0]=0,e[1]=0),e},createFrom:function(t,e){var i=new n(2);return i[0]=t,i[1]=e,i},add:function(t,e,i){return i||(i=e),i[0]=t[0]+e[0],i[1]=t[1]+e[1],i},subtract:function(t,e,i){return i||(i=e),i[0]=t[0]-e[0],i[1]=t[1]-e[1],i},multiply:function(t,e,i){return i||(i=e),i[0]=t[0]*e[0],i[1]=t[1]*e[1],i},divide:function(t,e,i){return i||(i=e),i[0]=t[0]/e[0],i[1]=t[1]/e[1],i},scale:function(t,e,i){return i||(i=t),i[0]=t[0]*e,i[1]=t[1]*e,i},dist:function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},set:function(t,e){return e[0]=t[0],e[1]=t[1],e},equal:function(t,e){return t===e||1e-6>Math.abs(t[0]-e[0])&&1e-6>Math.abs(t[1]-e[1])},negate:function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e},normalize:function(t,e){e||(e=t);var i=t[0]*t[0]+t[1]*t[1];return 0<i?(i=Math.sqrt(i),e[0]=t[0]/i,e[1]=t[1]/i):e[0]=e[1]=0,e},cross:function(t,e,i){return t=t[0]*e[1]-t[1]*e[0],i?(i[0]=i[1]=0,i[2]=t,i):t},length:function(t){var e=t[0],t=t[1];return Math.sqrt(e*e+t*t)},squaredLength:function(t){var e=t[0],t=t[1];return e*e+t*t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},direction:function(t,e,i){i||(i=t);var r=t[0]-e[0],t=t[1]-e[1],e=r*r+t*t;return e?(e=1/Math.sqrt(e),i[0]=r*e,i[1]=t*e,i):(i[0]=0,i[1]=0,i[2]=0,i)},lerp:function(t,e,i,r){return r||(r=t),r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r},str:function(t){return"["+t[0]+", "+t[1]+"]"}},v={create:function(t){var e=new n(4);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):e[0]=e[1]=e[2]=e[3]=0,e},createFrom:function(t,e,i,r){var a=new n(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},equal:function(t,e){return t===e||1e-6>Math.abs(t[0]-e[0])&&1e-6>Math.abs(t[1]-e[1])&&1e-6>Math.abs(t[2]-e[2])&&1e-6>Math.abs(t[3]-e[3])},identity:function(t){return t||(t=v.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},transpose:function(t,e){if(!e||t===e){var i=t[1];return t[1]=t[2],t[2]=i,t}return e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3],e},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},inverse:function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],a=t[3],s=i*a-n*r;return s?(s=1/s,e[0]=a*s,e[1]=-r*s,e[2]=-n*s,e[3]=i*s,e):null},multiply:function(t,e,i){i||(i=t);var r=t[0],n=t[1],a=t[2],t=t[3];return i[0]=r*e[0]+n*e[2],i[1]=r*e[1]+n*e[3],i[2]=a*e[0]+t*e[2],i[3]=a*e[1]+t*e[3],i},rotate:function(t,e,i){i||(i=t);var r=t[0],n=t[1],a=t[2],t=t[3],s=Math.sin(e),e=Math.cos(e);return i[0]=r*e+n*s,i[1]=r*-s+n*e,i[2]=a*e+t*s,i[3]=a*-s+t*e,i},multiplyVec2:function(t,e,i){i||(i=e);var r=e[0],e=e[1];return i[0]=r*t[0]+e*t[1],i[1]=r*t[2]+e*t[3],i},scale:function(t,e,i){i||(i=t);var r=t[1],n=t[2],a=t[3],s=e[0],e=e[1];return i[0]=t[0]*s,i[1]=r*e,i[2]=n*s,i[3]=a*e,i},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"}},M={create:function(t){var e=new n(4);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e},createFrom:function(t,e,i,r){var a=new n(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a},add:function(t,e,i){return i||(i=e),i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i},subtract:function(t,e,i){return i||(i=e),i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i},multiply:function(t,e,i){return i||(i=e),i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i[3]=t[3]*e[3],i},divide:function(t,e,i){return i||(i=e),i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i[3]=t[3]/e[3],i},scale:function(t,e,i){return i||(i=t),i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},equal:function(t,e){return t===e||1e-6>Math.abs(t[0]-e[0])&&1e-6>Math.abs(t[1]-e[1])&&1e-6>Math.abs(t[2]-e[2])&&1e-6>Math.abs(t[3]-e[3])},negate:function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},length:function(t){var e=t[0],i=t[1],r=t[2],t=t[3];return Math.sqrt(e*e+i*i+r*r+t*t)},squaredLength:function(t){var e=t[0],i=t[1],r=t[2],t=t[3];return e*e+i*i+r*r+t*t},lerp:function(t,e,i,r){return r||(r=t),r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r[2]=t[2]+i*(e[2]-t[2]),r[3]=t[3]+i*(e[3]-t[3]),r},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"}};return t&&(t.glMatrixArrayType=n,t.MatrixArray=n,t.setMatrixArrayType=e,t.determineMatrixArrayType=i,t.glMath=r,t.vec2=d,t.vec3=a,t.vec4=M,t.mat2=v,t.mat3=g,t.mat4=f,t.quat4=p),{glMatrixArrayType:n,MatrixArray:n,setMatrixArrayType:e,determineMatrixArrayType:i,glMath:r,vec2:d,vec3:a,vec4:M,mat2:v,mat3:g,mat4:f,quat4:p}});